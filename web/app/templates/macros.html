{# Macros for rendering form controls. #}
{% macro form_field(elem, prepend='') -%}
<div class="form-group">
    {{ elem.label }}
    <div class="input-group">
        {%- if prepend -%}
            <div class="input-group-prepend">
                <span class="input-group-text">{{ prepend }}</span>
            </div>
        {%- endif %}
        {%- if elem.errors -%}
            {{ elem(class_='form-control is-invalid', **kwargs) }}
        {%- else -%}
            {{ elem(class_='form-control', **kwargs) }}
        {%- endif -%}
        <div class="invalid-feedback">
            {% for error in elem.errors %}{{ error }}{% endfor %}
        </div>
    </div>
</div>
{%- endmacro %}

{% macro form_check(elem) -%}
<div class="form-check">{{ elem(class_='form-check-input', **kwargs) }}{{ elem.label }}</div>
{%- endmacro %}

{% macro form_submit(elem) -%}
{{ elem(class_='btn btn-primary', **kwargs) }}
{%- endmacro %}


{# Renders pagination buttons for a pagination object and an endpoint. #}
{% macro show_pages(pagination, endpoint) %}
<ul class="pagination">
    {% if pagination.has_prev %}
    <li class="page-item"><a class="page-link" href="{{ url_for(endpoint, page=pagination.prev_num, **kwargs) }}">Previous</a></li>
    {% else %}
    <li class="page-item disabled"><span class="page-link">Previous</span></li>
    {% endif %}

    {% for page in pagination.iter_pages() %}
    <li class="page-item {% if page == pagination.page %}active{% endif %}"><a class="page-link" href="{{ url_for(endpoint, page=page, **kwargs) }}">{{ page }}</a></li>
    {% else %}
    <li class="page-item disabled"><span class="page-link">...</span></li>
    {% endfor %}

    {% if pagination.has_next %}
    <li class="page-item"><a class="page-link" href="{{ url_for(endpoint, page=pagination.next_num, **kwargs) }}">Next</a></li>
    {% else %}
    <li class="page-item disabled"><span class="page-link">Next</span></li>
    {% endif %}
</ul>
{% endmacro %}


{# Loads a form into a modal using jQuery. Must be placed in the $(document).ready() handler. #}
{% macro dynamic_form(button_id, modal_id, form_endpoint, form_id, submit_id) %}
$('#' + '{{ button_id }}').click(function() {
    $.get('{{ form_endpoint }}', function(data) {
        $('#' + '{{ modal_id }}' + ' .modal-content').html(data);
       $('#' + '{{ modal_id }}').modal('show')

        $('#' + '{{ submit_id }}').click(function(event) {
            event.preventDefault();
            $.post('{{ form_endpoint }}', data=$('#' + '{{ form_id }}').serialize(), function(data) {
                if (data.status == 'ok') {
                    $('#' + '{{ modal_id }}').modal('hide');
                    location.reload();
                } else {
                    $('#' + '{{ modal_id }}' + ' .modal-content').html(data)
                }
            });
        });
    });
});
{% endmacro %}